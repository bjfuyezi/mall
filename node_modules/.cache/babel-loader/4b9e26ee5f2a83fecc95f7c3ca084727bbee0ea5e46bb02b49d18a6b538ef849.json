{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport QRCode from 'qrcodejs2';\nimport axios from 'axios';\nexport default {\n  name: 'UserOrdersView',\n  data() {\n    return {\n      activeTab: 'all',\n      orders: [\n        /*{\r\n          id: '4',\r\n          date: '2024-03-20 15:30:00',\r\n          status: 'pending',\r\n          products: [\r\n            {\r\n              id: 1,\r\n              name: '示例商品1',\r\n              price: 999,\r\n              image: 'https://via.placeholder.com/120'\r\n            }\r\n          ],\r\n          totalQuantity: 1,\r\n          totalAmount: 999\r\n        },\r\n        {\r\n          id: '2',\r\n          date: '2024-03-20 14:30:00',\r\n          status: 'completed',\r\n          products: [\r\n            {\r\n              id: 2,\r\n              name: '示例商品2',\r\n              price: 299,\r\n              image: 'https://via.placeholder.com/120'\r\n            }\r\n          ],\r\n          totalQuantity: 2,\r\n          totalAmount: 598\r\n        }*/\n      ],\n      showPayMethodDialog: false,\n      showPayDialog: false,\n      payMethod: '',\n      payTypeText: '',\n      qrCodeInstance: null,\n      currentPayAmount: 0,\n      currentPayOrder: null\n    };\n  },\n  created() {\n    const userid = this.$store.getters.userId;\n    // 获取所有订单\n    axios.post('http://localhost:8081/order/getOrdervo', {\n      user_id: userid\n    }).then(response => {\n      this.orders = response.data;\n    }).catch(error => {\n      this.$message.error('获取订单列表失败');\n      console.error('Error fetching orders:', error);\n    });\n\n    // 获取路由中的订单ID\n    const orderId = this.$route.query.orderId;\n    if (orderId) {\n      // 如果有订单ID，可以直接定位到该订单\n      this.scrollToOrder(orderId);\n    }\n  },\n  methods: {\n    handleTabClick(tab) {\n      // 获取当前选中的标签名称\n      const status = tab.name;\n\n      // 构造请求数据\n      const requestData = {\n        status: status === 'all' ? null : status,\n        user_id: this.userId // 使用 data 中的 userId\n      };\n\n      // 发送请求到后端\n      axios.post('http://localhost:8081/order/getkindOrdervo', requestData).then(response => {\n        if (response.data) {\n          this.orders = response.data;\n        }\n      }).catch(error => {\n        this.$message.error('获取订单列表失败');\n        console.error('Error fetching orders:', error);\n      });\n    },\n    async payOrder(order) {\n      this.currentPayOrder = order;\n      this.currentPayAmount = order.totalAmount;\n      this.showPayMethodDialog = true;\n    },\n    async selectPayMethod(method) {\n      this.payMethod = method;\n      this.payTypeText = method === 'wechat' ? '微信' : '支付宝';\n      this.showPayMethodDialog = false;\n      try {\n        /*// 调用后端接口获取支付链接\r\n        const response = await this.$axios.post('/order/pay', {\r\n          orderId: this.currentPayOrder.order_id,\r\n          amount: this.currentPayAmount,\r\n          payMethod: method\r\n        });\r\n        \r\n        // 显示支付二维码\r\n        this.showPayDialog = true;\r\n        this.$nextTick(() => {\r\n          this.generateQRCode(response.data.payUrl || 'https://example.com/pay');\r\n        });\r\n        \r\n        // 开始轮询支付状态\r\n        this.startCheckPayStatus(this.currentPayOrder.order_id);*/\n        this.showPayDialog = true;\n        const testPayUrl = method === 'wechat' ? `weixin://wxpay/bizpayurl?pr=order_${this.currentPayOrder.order_id}_${this.currentPayAmount}` : `https://qr.alipay.com/pay?order=${this.currentPayOrder.order_id}&amount=${this.currentPayAmount}`;\n\n        // 在对话框显示后生成二维码，并设置不同的颜色\n        this.$nextTick(() => {\n          this.generateQRCode(testPayUrl, method);\n        });\n      } catch (error) {\n        this.$message.error('创建支付订单失败，请重试');\n        console.error('创建支付订单失败:', error);\n      }\n    },\n    generateQRCode(url, payMethod) {\n      // 清除已存在的二维码\n      if (this.qrCodeInstance) {\n        this.qrCodeInstance.clear();\n      }\n      const qrContainer = this.$refs.qrCode;\n      if (qrContainer) {\n        qrContainer.innerHTML = '';\n        this.qrCodeInstance = new QRCode(qrContainer, {\n          text: url,\n          width: 200,\n          height: 200,\n          colorDark: payMethod === 'wechat' ? '#2C8722' : '#00A0E9',\n          // 微信绿色 vs 支付宝蓝色\n          colorLight: '#ffffff',\n          correctLevel: QRCode.CorrectLevel.H\n        });\n      }\n    },\n    cancelPay() {\n      this.$confirm('确定要取消支付吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.showPayDialog = false;\n        this.stopCheckPayStatus();\n      }).catch(() => {});\n    },\n    async confirmPay() {\n      try {\n        // 调用后端验证支付状态\n        const response = await this.$axios.post('http://localhost:8081/order/pay', {\n          order_id: this.currentPayOrder.order_id,\n          payment_method: this.payTypeText\n        });\n        /*\r\n        if (response.data.paid) {\r\n          this.$message.success('支付成功！');\r\n          this.showPayDialog = false;\r\n          // 更新订单状态\r\n          this.currentPayOrder.status = '待发货';\r\n          this.stopCheckPayStatus();\r\n        } else {\r\n          this.$message.warning('未检测到支付，请确认是否已完成支付');\r\n        }*/\n        if (response.status === 201) {\n          this.$message.success('支付成功！');\n          this.showPayDialog = false;\n\n          // 更新当前订单的状态\n          const orderIndex = this.orders.findIndex(o => o.order_id === this.currentPayOrder.order_id);\n          if (orderIndex !== -1) {\n            // 使用 Vue.set 确保视图更新\n            this.$set(this.orders[orderIndex], 'status', 'delivered');\n          }\n\n          // 重新获取最新的订单列表\n          const ordersResponse = await this.$axios.post('http://localhost:8081/order/getOrdervo');\n          if (ordersResponse.data) {\n            this.orders = ordersResponse.data;\n          }\n          this.stopCheckPayStatus();\n        } else {\n          this.$message.warning('未检测到支付，请确认是否已完成支付');\n        }\n      } catch (error) {\n        this.$message.error('验证支付状态失败，请稍后重试');\n        console.error('验证支付失败:', error);\n      }\n    },\n    startCheckPayStatus(orderId) {\n      this.payStatusTimer = setInterval(async () => {\n        try {\n          const response = await this.$axios.get(`/api/payment/status/${orderId}`);\n          if (response.data.paid) {\n            this.$message.success('支付成功！');\n            this.showPayDialog = false;\n            // 更新订单状态\n            this.currentPayOrder.status = '待发货';\n            this.stopCheckPayStatus();\n          }\n        } catch (error) {\n          console.error('检查支付状态失败:', error);\n        }\n      }, 3000); // 每3秒检查一次\n    },\n    stopCheckPayStatus() {\n      if (this.payStatusTimer) {\n        clearInterval(this.payStatusTimer);\n        this.payStatusTimer = null;\n      }\n    },\n    confirmReceive(order) {\n      console.log('确认收货：', order.id);\n    },\n    reviewOrder(order) {\n      this.$router.push({\n        name: 'user-review',\n        query: {\n          orderId: order.id,\n          productId: order.products[0].id // 如果一个订单只有一个商品\n        }\n      });\n    },\n    viewOrderDetail(order) {\n      this.$router.push(`/user/orders/${order.id}`);\n    },\n    scrollToOrder(orderId) {\n      // 可以添加一些视觉效果，比如高亮显示该订单\n      this.$nextTick(() => {\n        const orderElement = document.getElementById(`order-${orderId}`);\n        if (orderElement) {\n          orderElement.scrollIntoView({\n            behavior: 'smooth'\n          });\n          // 可以添加临时的高亮效果\n          orderElement.classList.add('highlight');\n          setTimeout(() => {\n            orderElement.classList.remove('highlight');\n          }, 3000);\n        }\n      });\n    },\n    /*async addToCart(order) {\r\n      try {\r\n        // 获取订单中的第一个商品\r\n        const product = order.products[0];\r\n        \r\n        const cartData = {\r\n          user_id: 1, // 应该从用户状态中获取\r\n          product_id: product.id,\r\n          quantity: product.quantity,\r\n          shop_id: order.shop_id || 1 // 如果订单中有店铺ID就使用，否则默认为1\r\n        };\r\n          const response = await this.$axios.post('http://localhost:8081/cart/add', cartData);\r\n        \r\n        if (response.status === 201) {\r\n          this.$message.success('已添加到购物车');\r\n        } else {\r\n          throw new Error(response.data.message || '添加失败');\r\n        }\r\n      } catch (error) {\r\n        this.$message.error(error.message || '添加到购物车失败，请重试');\r\n        console.error('添加到购物车失败:', error);\r\n      }\r\n    }*/\n    getStatusText(status) {\n      const statusMap = {\n        'pending': '待支付',\n        'delivered': '待收货',\n        'cancelled': '已取消',\n        'completed': '已完成'\n      };\n      return statusMap[status] || status;\n    }\n  },\n  beforeDestroy() {\n    this.stopCheckPayStatus();\n    // 清除二维码实例\n    if (this.qrCodeInstance) {\n      this.qrCodeInstance.clear();\n    }\n  }\n};","map":{"version":3,"names":["QRCode","axios","name","data","activeTab","orders","showPayMethodDialog","showPayDialog","payMethod","payTypeText","qrCodeInstance","currentPayAmount","currentPayOrder","created","userid","$store","getters","userId","post","user_id","then","response","catch","error","$message","console","orderId","$route","query","scrollToOrder","methods","handleTabClick","tab","status","requestData","payOrder","order","totalAmount","selectPayMethod","method","testPayUrl","order_id","$nextTick","generateQRCode","url","clear","qrContainer","$refs","qrCode","innerHTML","text","width","height","colorDark","colorLight","correctLevel","CorrectLevel","H","cancelPay","$confirm","confirmButtonText","cancelButtonText","type","stopCheckPayStatus","confirmPay","$axios","payment_method","success","orderIndex","findIndex","o","$set","ordersResponse","warning","startCheckPayStatus","payStatusTimer","setInterval","get","paid","clearInterval","confirmReceive","log","id","reviewOrder","$router","push","productId","products","viewOrderDetail","orderElement","document","getElementById","scrollIntoView","behavior","classList","add","setTimeout","remove","getStatusText","statusMap","beforeDestroy"],"sources":["src/views/usermodel/UserOrdersView.vue"],"sourcesContent":["<template>\r\n  <div class=\"user-orders-container\">\r\n    <div class=\"user-orders-page\">\r\n      <div class=\"orders-container\">\r\n        <h2>我的订单</h2>\r\n        \r\n        <!-- 订单状态标签 -->\r\n        <div class=\"order-tabs\">\r\n          <el-tabs v-model=\"activeTab\" @tab-click=\"handleTabClick\">\r\n            <el-tab-pane label=\"全部\" name=\"all\"></el-tab-pane>\r\n            <el-tab-pane label=\"待付款\" name=\"unpaid\"></el-tab-pane>\r\n            <el-tab-pane label=\"待收货\" name=\"unreceive\"></el-tab-pane>\r\n            <el-tab-pane label=\"已完成\" name=\"completed\"></el-tab-pane>\r\n            <el-tab-pane label=\"已取消\" name=\"cancelled\"></el-tab-pane>\r\n          </el-tabs>\r\n        </div>\r\n  \r\n        <!-- 订单列表 -->\r\n        <div class=\"order-list\">\r\n          <div v-for=\"order in orders\" :key=\"order.order_id\" :id=\"`order-${order.order_id}`\" class=\"order-item\">\r\n            <div class=\"order-header\">\r\n              <div class=\"order-info\">\r\n                <span class=\"order-id\">订单号：{{ order.order_id }}</span>\r\n                <span class=\"order-date\">{{ new Date(order.date).toLocaleString() }}</span>\r\n              </div>\r\n              <div class=\"order-status\">{{ getStatusText(order.status) }}</div>\r\n            </div>\r\n  \r\n            <div class=\"order-products\">\r\n              <div class=\"product-item\">\r\n                <img :src=\"order.product_image\" :alt=\"order.product_name\">\r\n                <div class=\"product-info\">\r\n                  <h4>{{ order.product_name }}</h4>\r\n                  <div class=\"product-price\">\r\n                    <span class=\"price\">¥{{ order.product_price.toFixed(2) }}</span>\r\n                    <span class=\"quantity\">x{{ order.totalQuantity }}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n  \r\n            <div class=\"order-footer\">\r\n              <div class=\"order-total\">\r\n                共 {{ order.totalQuantity }} 件商品，\r\n                实付款：<span class=\"total-price\">¥{{ order.totalAmount.toFixed(2) }}</span>\r\n              </div>\r\n              <div class=\"order-actions\">\r\n                <el-button \r\n                  v-if=\"order.status === 'pending'\" \r\n                  type=\"primary\"\r\n                  size=\"small\"\r\n                  @click=\"payOrder(order)\"\r\n                >\r\n                  立即付款\r\n                </el-button>\r\n                <el-button \r\n                  v-if=\"order.status === 'delivered'\" \r\n                  type=\"success\"\r\n                  size=\"small\"\r\n                  @click=\"confirmReceive(order)\"\r\n                >\r\n                  确认收货\r\n                </el-button>\r\n                <el-button \r\n                  v-if=\"order.status === 'completed'\" \r\n                  type=\"primary\"\r\n                  plain\r\n                  size=\"small\"\r\n                  @click=\"reviewOrder(order)\"\r\n                >\r\n                  评价\r\n                </el-button>\r\n                <el-button \r\n                  type=\"text\"\r\n                  size=\"small\"\r\n                  @click=\"addToCart(order)\"\r\n                >\r\n                  加入购物车\r\n                </el-button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n  \r\n        <!-- 空状态 -->\r\n        <div v-if=\"orders.length === 0\" class=\"empty-state\">\r\n          <i class=\"el-icon-document\"></i>\r\n          <p>暂无相关订单</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 选择支付方式对话框 -->\r\n    <el-dialog\r\n      title=\"选择支付方式\"\r\n      :visible.sync=\"showPayMethodDialog\"\r\n      width=\"300px\"\r\n      center\r\n      :close-on-click-modal=\"false\"\r\n    >\r\n      <div class=\"pay-method-content\">\r\n        <el-button class=\"pay-method-btn\" @click=\"selectPayMethod('wechat')\">\r\n          <i class=\"el-icon-goods\"></i>\r\n          微信支付\r\n        </el-button>\r\n        <el-button class=\"pay-method-btn\" @click=\"selectPayMethod('alipay')\">\r\n          <i class=\"el-icon-goods\"></i>\r\n          支付宝支付\r\n        </el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n    <!-- 添加支付二维码对话框 -->\r\n    <el-dialog\r\n      :title=\"payTypeText\"\r\n      :visible.sync=\"showPayDialog\"\r\n      width=\"300px\"\r\n      center\r\n      :close-on-click-modal=\"false\"\r\n    >\r\n      <div class=\"pay-dialog-content\">\r\n        <p class=\"pay-type-text\">{{ payTypeText }}扫码支付</p>\r\n        <div class=\"qr-code\" ref=\"qrCode\"></div>\r\n        <div class=\"pay-amount\">\r\n          支付金额：<span class=\"price\">¥{{ currentPayAmount }}</span>\r\n        </div>\r\n        <div class=\"pay-tips\">\r\n          <p>请使用{{ payTypeText }}扫描二维码完成支付</p>\r\n          <p class=\"small\">支付完成前请不要关闭窗口</p>\r\n        </div>\r\n      </div>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"cancelPay\">取消支付</el-button>\r\n        <el-button type=\"primary\" @click=\"confirmPay\">确认已支付</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport QRCode from 'qrcodejs2';\r\nimport axios from 'axios';\r\nexport default {\r\n  name: 'UserOrdersView',\r\n  data() {\r\n    return {\r\n      activeTab: 'all',\r\n      orders: [\r\n        /*{\r\n          id: '4',\r\n          date: '2024-03-20 15:30:00',\r\n          status: 'pending',\r\n          products: [\r\n            {\r\n              id: 1,\r\n              name: '示例商品1',\r\n              price: 999,\r\n              image: 'https://via.placeholder.com/120'\r\n            }\r\n          ],\r\n          totalQuantity: 1,\r\n          totalAmount: 999\r\n        },\r\n        {\r\n          id: '2',\r\n          date: '2024-03-20 14:30:00',\r\n          status: 'completed',\r\n          products: [\r\n            {\r\n              id: 2,\r\n              name: '示例商品2',\r\n              price: 299,\r\n              image: 'https://via.placeholder.com/120'\r\n            }\r\n          ],\r\n          totalQuantity: 2,\r\n          totalAmount: 598\r\n        }*/\r\n      ],\r\n      showPayMethodDialog: false,\r\n      showPayDialog: false,\r\n      payMethod: '',\r\n      payTypeText: '',\r\n      qrCodeInstance: null,\r\n      currentPayAmount: 0,\r\n      currentPayOrder: null\r\n    }\r\n  },\r\n  \r\n  created() {\r\n    const userid = this.$store.getters.userId;\r\n    // 获取所有订单\r\n    axios.post('http://localhost:8081/order/getOrdervo', {\r\n      user_id: userid\r\n    })\r\n    .then(response => {\r\n      this.orders = response.data;\r\n    })\r\n    .catch(error => {\r\n      this.$message.error('获取订单列表失败');\r\n      console.error('Error fetching orders:', error);\r\n    });\r\n\r\n    // 获取路由中的订单ID\r\n    const orderId = this.$route.query.orderId;\r\n    if (orderId) {\r\n      // 如果有订单ID，可以直接定位到该订单\r\n      this.scrollToOrder(orderId);\r\n    }\r\n  },\r\n  methods: {\r\n    handleTabClick(tab) {\r\n      // 获取当前选中的标签名称\r\n      const status = tab.name;\r\n      \r\n      // 构造请求数据\r\n      const requestData = {\r\n        status: status === 'all' ? null : status,\r\n        user_id: this.userId  // 使用 data 中的 userId\r\n      };\r\n\r\n      // 发送请求到后端\r\n      axios.post('http://localhost:8081/order/getkindOrdervo', requestData)\r\n        .then(response => {\r\n          if (response.data) {\r\n            this.orders = response.data;\r\n          }\r\n        })\r\n        .catch(error => {\r\n          this.$message.error('获取订单列表失败');\r\n          console.error('Error fetching orders:', error);\r\n        });\r\n    },\r\n    async payOrder(order) {\r\n      this.currentPayOrder = order;\r\n      this.currentPayAmount = order.totalAmount;\r\n      this.showPayMethodDialog = true;\r\n    },\r\n    async selectPayMethod(method) {\r\n      this.payMethod = method;\r\n      this.payTypeText = method === 'wechat' ? '微信' : '支付宝';\r\n      this.showPayMethodDialog = false;\r\n      try {\r\n        /*// 调用后端接口获取支付链接\r\n        const response = await this.$axios.post('/order/pay', {\r\n          orderId: this.currentPayOrder.order_id,\r\n          amount: this.currentPayAmount,\r\n          payMethod: method\r\n        });\r\n        \r\n        // 显示支付二维码\r\n        this.showPayDialog = true;\r\n        this.$nextTick(() => {\r\n          this.generateQRCode(response.data.payUrl || 'https://example.com/pay');\r\n        });\r\n        \r\n        // 开始轮询支付状态\r\n        this.startCheckPayStatus(this.currentPayOrder.order_id);*/\r\n        this.showPayDialog = true;\r\n        const testPayUrl = method === 'wechat' \r\n          ? `weixin://wxpay/bizpayurl?pr=order_${this.currentPayOrder.order_id}_${this.currentPayAmount}` \r\n          : `https://qr.alipay.com/pay?order=${this.currentPayOrder.order_id}&amount=${this.currentPayAmount}`;\r\n\r\n        // 在对话框显示后生成二维码，并设置不同的颜色\r\n        this.$nextTick(() => {\r\n          this.generateQRCode(testPayUrl, method);\r\n        });\r\n        \r\n      } catch (error) {\r\n        this.$message.error('创建支付订单失败，请重试');\r\n        console.error('创建支付订单失败:', error);\r\n      }\r\n    },\r\n    generateQRCode(url, payMethod) {\r\n      // 清除已存在的二维码\r\n      if (this.qrCodeInstance) {\r\n        this.qrCodeInstance.clear();\r\n      }\r\n      const qrContainer = this.$refs.qrCode;\r\n      if (qrContainer) {\r\n        qrContainer.innerHTML = '';\r\n        this.qrCodeInstance = new QRCode(qrContainer, {\r\n          text: url,\r\n          width: 200,\r\n          height: 200,\r\n          colorDark: payMethod === 'wechat' ? '#2C8722' : '#00A0E9',  // 微信绿色 vs 支付宝蓝色\r\n          colorLight: '#ffffff',\r\n          correctLevel: QRCode.CorrectLevel.H\r\n        });\r\n      }\r\n    },\r\n    cancelPay() {\r\n      this.$confirm('确定要取消支付吗？', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        this.showPayDialog = false;\r\n        this.stopCheckPayStatus();\r\n      }).catch(() => {});\r\n    },\r\n    async confirmPay() {\r\n      try {\r\n        // 调用后端验证支付状态\r\n        const response = await this.$axios.post('http://localhost:8081/order/pay', {\r\n          order_id: this.currentPayOrder.order_id,\r\n          payment_method:this.payTypeText\r\n        });\r\n        /*\r\n        if (response.data.paid) {\r\n          this.$message.success('支付成功！');\r\n          this.showPayDialog = false;\r\n          // 更新订单状态\r\n          this.currentPayOrder.status = '待发货';\r\n          this.stopCheckPayStatus();\r\n        } else {\r\n          this.$message.warning('未检测到支付，请确认是否已完成支付');\r\n        }*/\r\n        if (response.status === 201) {\r\n          this.$message.success('支付成功！');\r\n          this.showPayDialog = false;\r\n          \r\n          // 更新当前订单的状态\r\n          const orderIndex = this.orders.findIndex(o => o.order_id === this.currentPayOrder.order_id);\r\n          if (orderIndex !== -1) {\r\n            // 使用 Vue.set 确保视图更新\r\n            this.$set(this.orders[orderIndex], 'status', 'delivered');\r\n          }\r\n          \r\n          // 重新获取最新的订单列表\r\n          const ordersResponse = await this.$axios.post('http://localhost:8081/order/getOrdervo');\r\n          if (ordersResponse.data) {\r\n            this.orders = ordersResponse.data;\r\n          }\r\n          \r\n          this.stopCheckPayStatus();\r\n        } else {\r\n          this.$message.warning('未检测到支付，请确认是否已完成支付');\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('验证支付状态失败，请稍后重试');\r\n        console.error('验证支付失败:', error);\r\n      }\r\n    },\r\n    startCheckPayStatus(orderId) {\r\n      this.payStatusTimer = setInterval(async () => {\r\n        try {\r\n          const response = await this.$axios.get(`/api/payment/status/${orderId}`);\r\n          if (response.data.paid) {\r\n            this.$message.success('支付成功！');\r\n            this.showPayDialog = false;\r\n            // 更新订单状态\r\n            this.currentPayOrder.status = '待发货';\r\n            this.stopCheckPayStatus();\r\n          }\r\n        } catch (error) {\r\n          console.error('检查支付状态失败:', error);\r\n        }\r\n      }, 3000); // 每3秒检查一次\r\n    },\r\n    stopCheckPayStatus() {\r\n      if (this.payStatusTimer) {\r\n        clearInterval(this.payStatusTimer);\r\n        this.payStatusTimer = null;\r\n      }\r\n    },\r\n    confirmReceive(order) {\r\n      console.log('确认收货：', order.id)\r\n    },\r\n    reviewOrder(order) {\r\n      this.$router.push({\r\n        name: 'user-review',\r\n        query: {\r\n          orderId: order.id,\r\n          productId: order.products[0].id // 如果一个订单只有一个商品\r\n        }\r\n      });\r\n    },\r\n    viewOrderDetail(order) {\r\n      this.$router.push(`/user/orders/${order.id}`);\r\n    },\r\n    scrollToOrder(orderId) {\r\n      // 可以添加一些视觉效果，比如高亮显示该订单\r\n      this.$nextTick(() => {\r\n        const orderElement = document.getElementById(`order-${orderId}`);\r\n        if (orderElement) {\r\n          orderElement.scrollIntoView({ behavior: 'smooth' });\r\n          // 可以添加临时的高亮效果\r\n          orderElement.classList.add('highlight');\r\n          setTimeout(() => {\r\n            orderElement.classList.remove('highlight');\r\n          }, 3000);\r\n        }\r\n      });\r\n    },\r\n    /*async addToCart(order) {\r\n      try {\r\n        // 获取订单中的第一个商品\r\n        const product = order.products[0];\r\n        \r\n        const cartData = {\r\n          user_id: 1, // 应该从用户状态中获取\r\n          product_id: product.id,\r\n          quantity: product.quantity,\r\n          shop_id: order.shop_id || 1 // 如果订单中有店铺ID就使用，否则默认为1\r\n        };\r\n\r\n        const response = await this.$axios.post('http://localhost:8081/cart/add', cartData);\r\n        \r\n        if (response.status === 201) {\r\n          this.$message.success('已添加到购物车');\r\n        } else {\r\n          throw new Error(response.data.message || '添加失败');\r\n        }\r\n      } catch (error) {\r\n        this.$message.error(error.message || '添加到购物车失败，请重试');\r\n        console.error('添加到购物车失败:', error);\r\n      }\r\n    }*/\r\n    getStatusText(status) {\r\n      const statusMap = {\r\n        'pending': '待支付',\r\n        'delivered': '待收货',\r\n        'cancelled': '已取消',\r\n        'completed': '已完成'\r\n      }\r\n      return statusMap[status] || status\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    this.stopCheckPayStatus();\r\n    // 清除二维码实例\r\n    if (this.qrCodeInstance) {\r\n      this.qrCodeInstance.clear();\r\n    }\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.user-orders-container {\r\n  width: 100%;\r\n}\r\n\r\n.user-orders-page {\r\n  background-color: #f5f5f5;\r\n  padding: 20px 0;\r\n  min-height: calc(100vh - 120px);\r\n}\r\n\r\n.orders-container {\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n  padding: 0 20px;\r\n\r\n  h2 {\r\n    margin-bottom: 20px;\r\n    font-size: 24px;\r\n    font-weight: normal;\r\n  }\r\n}\r\n\r\n.order-list {\r\n  .order-item {\r\n    background: white;\r\n    border-radius: 8px;\r\n    margin-bottom: 20px;\r\n    overflow: hidden;\r\n\r\n    .order-header {\r\n      padding: 15px 20px;\r\n      border-bottom: 1px solid #eee;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n\r\n      .order-info {\r\n        .order-id {\r\n          margin-right: 20px;\r\n          color: #666;\r\n        }\r\n\r\n        .order-date {\r\n          color: #999;\r\n        }\r\n      }\r\n\r\n      .order-status {\r\n        color: #ff6700;\r\n        font-weight: bold;\r\n      }\r\n    }\r\n\r\n    .order-products {\r\n      padding: 20px;\r\n\r\n      .product-item {\r\n        display: flex;\r\n        gap: 15px;\r\n        padding: 10px 0;\r\n\r\n        img {\r\n          width: 80px;\r\n          height: 80px;\r\n          object-fit: cover;\r\n          border-radius: 4px;\r\n        }\r\n\r\n        .product-info {\r\n          flex: 1;\r\n\r\n          h4 {\r\n            margin: 0 0 5px;\r\n            font-size: 14px;\r\n          }\r\n\r\n          .product-spec {\r\n            color: #999;\r\n            font-size: 12px;\r\n            margin-bottom: 5px;\r\n          }\r\n\r\n          .product-price {\r\n            .price {\r\n              color: #ff6700;\r\n              font-weight: bold;\r\n              margin-right: 10px;\r\n            }\r\n\r\n            .quantity {\r\n              color: #999;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .order-footer {\r\n      padding: 15px 20px;\r\n      border-top: 1px solid #eee;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n\r\n      .order-total {\r\n        color: #666;\r\n\r\n        .total-price {\r\n          color: #ff6700;\r\n          font-weight: bold;\r\n          font-size: 18px;\r\n        }\r\n      }\r\n\r\n      .order-actions {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n    }\r\n\r\n    &.highlight {\r\n      animation: highlight 3s;\r\n    }\r\n  }\r\n}\r\n\r\n.empty-state {\r\n  text-align: center;\r\n  padding: 60px 0;\r\n  color: #999;\r\n\r\n  i {\r\n    font-size: 60px;\r\n    margin-bottom: 20px;\r\n  }\r\n}\r\n\r\n@keyframes highlight {\r\n  0% {\r\n    background-color: #fff1f0;\r\n  }\r\n  100% {\r\n    background-color: white;\r\n  }\r\n}\r\n\r\n.pay-method-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 15px;\r\n  padding: 10px 0;\r\n\r\n  .pay-method-btn {\r\n    height: 50px;\r\n    font-size: 16px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    gap: 10px;\r\n\r\n    i {\r\n      font-size: 20px;\r\n    }\r\n  }\r\n}\r\n\r\n.pay-dialog-content {\r\n  text-align: center;\r\n  padding: 20px 0;\r\n\r\n  .pay-type-text {\r\n    font-size: 18px;\r\n    color: #333;\r\n    margin-bottom: 20px;\r\n  }\r\n\r\n  .qr-code {\r\n    width: 200px;\r\n    height: 200px;\r\n    margin: 0 auto 20px;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n\r\n    img {\r\n      max-width: 100%;\r\n      max-height: 100%;\r\n    }\r\n  }\r\n\r\n  .pay-amount {\r\n    font-size: 18px;\r\n    margin-bottom: 15px;\r\n\r\n    .price {\r\n      color: #ff6700;\r\n      font-weight: bold;\r\n    }\r\n  }\r\n\r\n  .pay-tips {\r\n    color: #666;\r\n    \r\n    p {\r\n      margin: 5px 0;\r\n      \r\n      &.small {\r\n        font-size: 12px;\r\n        color: #999;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.dialog-footer {\r\n  text-align: center;\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}