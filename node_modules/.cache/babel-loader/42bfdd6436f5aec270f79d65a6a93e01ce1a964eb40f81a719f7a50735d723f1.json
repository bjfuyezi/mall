{"ast":null,"code":"import axios from 'axios';\nexport default {\n  name: 'AddAd',\n  data() {\n    return {\n      formData: {\n        ps_id: null,\n        name: '',\n        price: null,\n        picture: null,\n        // 这里将保存文件对象\n        selectedProduct: null,\n        // 新增字段用于存储选中的产品ID\n        times: 0 //推广次数\n      },\n      isSubmitting: false,\n      error: null,\n      products: [] // 存储从后端获取的产品列表\n    };\n  },\n  created() {\n    this.getProucts();\n  },\n  methods: {\n    handleFileChange(event) {\n      const file = event.target.files[0];\n      if (file) {\n        this.formData.picture = file; // 只保存第一个文件\n      } else {\n        this.formData.picture = null;\n      }\n    },\n    convertToInt(value) {\n      return value !== null && value !== '' ? parseInt(value, 10) : 0;\n    },\n    convertToFloat(value) {\n      return value !== null && value !== '' ? parseFloat(value).toFixed(2) : '0.00';\n    },\n    formatDate(isoString) {\n      // 将 ISO 字符串解析为 Date 对象\n      const date = new Date(isoString);\n      // 获取年份、月份和日期，并确保月份和日期是两位数\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      // 返回格式化的日期字符串\n      return `${year}-${month}-${day} 00:00:00`;\n    },\n    async getProucts() {\n      try {\n        // 从后端获取产品列表\n        //const response = await axios.get('http://localhost:8081/products');\n        this.products = [{\n          id: 1,\n          name: '商品1'\n        }, {\n          id: 2,\n          name: '商品2'\n        }, {\n          id: 3,\n          name: '商品3'\n        }]; //response.data; // 假设后端返回的是一个产品数组\n      } catch (err) {\n        this.error = '无法加载产品列表，请稍后再试';\n      }\n    },\n    async price_cal() {\n      try {\n        const response = await axios.get('http://localhost:8081/advertise/money', {\n          params: {\n            start: \"\",\n            end: \"\",\n            times: this.formData.times,\n            banner: false\n          }\n        });\n        this.formData.price = response.data; // 假设后端返回的是一个价格\n        console.log(this.price);\n      } catch (err) {\n        this.error = '无法加载预计价格，请稍等';\n      }\n    },\n    async handleSubmit() {\n      try {\n        this.isSubmitting = true;\n        this.error = null;\n        const formData = new FormData();\n        formData.append('name', this.formData.name);\n        // 曝光量必须是商品广告\n        formData.append('ps_id', this.convertToInt(this.formData.selectedProduct));\n        formData.append('type', 'product');\n        formData.append('start_time', null);\n        formData.append('end_time', null);\n        formData.append('times', this.convertToInt(this.formData.times));\n        formData.append('price', this.convertToFloat(this.formData.price));\n        formData.append('banner', false);\n\n        // 添加文件（如果有）\n        if (this.formData.picture) {\n          formData.append('picture', this.formData.picture); // 使用正确的键名 'pictrue'\n        }\n\n        // 发送请求到服务器\n        const response = await axios.post('http://localhost:8081/advertise/create', formData);\n        console.log(response);\n        console.log('Form submitted:', formData);\n        this.$emit('adAdded', {\n          ...this.formData\n        });\n        this.clearForm();\n      } catch (err) {\n        this.error = err.message || '发生错误，请稍后再试';\n      } finally {\n        this.isSubmitting = false;\n      }\n    },\n    clearForm() {\n      this.formData = {\n        ps_id: null,\n        name: '',\n        start_time: null,\n        end_time: null,\n        price: null,\n        picture: null\n      };\n      // 手动清除文件输入框\n      this.$refs.pictureInput.value = null;\n    }\n  }\n};","map":{"version":3,"names":["axios","name","data","formData","ps_id","price","picture","selectedProduct","times","isSubmitting","error","products","created","getProucts","methods","handleFileChange","event","file","target","files","convertToInt","value","parseInt","convertToFloat","parseFloat","toFixed","formatDate","isoString","date","Date","year","getFullYear","month","String","getMonth","padStart","day","getDate","id","err","price_cal","response","get","params","start","end","banner","console","log","handleSubmit","FormData","append","post","$emit","clearForm","message","start_time","end_time","$refs","pictureInput"],"sources":["src/components/AddAd.vue"],"sourcesContent":["<template>\r\n  <form @submit.prevent=\"handleSubmit\" class=\"add-ad-form\">  \r\n    <h2>购买曝光量</h2>\r\n\r\n    <!-- 广告标题 -->\r\n    <div class=\"form-group\">\r\n      <label for=\"name\">名称</label>\r\n      <input id=\"name\" v-model=\"formData.name\" type=\"text\" required />\r\n    </div>\r\n\r\n<!-- 动态显示的产品选择下拉列表 -->\r\n    <div class=\"form-group\">\r\n      <label for=\"product\">选择商品</label>\r\n      <select id=\"product\" v-model=\"formData.selectedProduct\" required>\r\n        <option v-for=\"product in products\" :key=\"product.id\" :value=\"product.id\">\r\n          {{ product.name }}\r\n        </option>\r\n      </select>\r\n    </div>\r\n\r\n    <div class=\"form-group\">\r\n      <label for=\"times\">选择曝光量</label>\r\n      <input id=\"times\" v-model=\"formData.times\" type=\"text\" @change=\"price_cal\" required />\r\n    </div>\r\n\r\n    <!-- 价格 -->\r\n    <div class=\"form-group\">\r\n      <label for=\"price\">价格 (元)</label>\r\n      <input id=\"price\" v-model.number=\"formData.price\" type=\"number\" step=\"0.01\" min=\"0\" disabled/>\r\n    </div>\r\n\r\n  <!-- 图片上传 -->\r\n    <div class=\"form-group\">\r\n      <label for=\"picture\">图片</label>\r\n      <input id=\"picture\" ref=\"pictureInput\" type=\"file\" @change=\"handleFileChange\" />\r\n      <span v-if=\"formData.picture\">{{ formData.picture.name }}</span>\r\n      <span v-else class=\"error\" >请选择封面图片，默认使用商品封面</span>\r\n    </div>\r\n\r\n    <!-- 提交按钮 -->\r\n    <button type=\"submit\" :disabled=\"isSubmitting\">提交</button>\r\n\r\n    <!-- 错误信息 -->\r\n    <div v-if=\"error\" class=\"error\">{{ error }}</div>\r\n  </form>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\nexport default {\r\n  name: 'AddAd',\r\n  data() {\r\n    return {\r\n      formData: {\r\n        ps_id: null,\r\n        name: '',\r\n        price: null,\r\n        picture: null, // 这里将保存文件对象\r\n        selectedProduct: null, // 新增字段用于存储选中的产品ID\r\n        times: 0//推广次数\r\n      },\r\n      isSubmitting: false,\r\n      error: null,\r\n      products: [], // 存储从后端获取的产品列表\r\n    };\r\n  },\r\n  created(){\r\n    this.getProucts()\r\n  },\r\n  methods: {\r\n    handleFileChange(event) {\r\n      const file = event.target.files[0];\r\n      if (file) {\r\n        this.formData.picture = file; // 只保存第一个文件\r\n      } else {\r\n        this.formData.picture = null;\r\n      }\r\n    },\r\n    convertToInt(value) {\r\n      return value !== null && value !== '' ? parseInt(value, 10) : 0;\r\n    },\r\n    convertToFloat(value) {\r\n      return value !== null && value !== '' ? parseFloat(value).toFixed(2) : '0.00';\r\n    },formatDate(isoString) {\r\n      // 将 ISO 字符串解析为 Date 对象\r\n      const date = new Date(isoString);\r\n      // 获取年份、月份和日期，并确保月份和日期是两位数\r\n      const year = date.getFullYear();\r\n      const month = String(date.getMonth() + 1).padStart(2, '0');\r\n      const day = String(date.getDate()).padStart(2, '0');\r\n      // 返回格式化的日期字符串\r\n      return `${year}-${month}-${day} 00:00:00`;\r\n    },\r\n    async getProucts() {\r\n        try {\r\n          // 从后端获取产品列表\r\n          //const response = await axios.get('http://localhost:8081/products');\r\n          this.products = [{id:1,name:'商品1'},{id:2,name:'商品2'},{id:3,name:'商品3'}]//response.data; // 假设后端返回的是一个产品数组\r\n        } catch (err) {\r\n          this.error = '无法加载产品列表，请稍后再试';\r\n        }\r\n    },\r\n    async price_cal(){\r\n        try {\r\n          const response = await axios.get('http://localhost:8081/advertise/money',{\r\n            params: {\r\n            start: \"\",\r\n            end: \"\",\r\n            times: this.formData.times,\r\n            banner: false\r\n            }\r\n            });\r\n          this.formData.price = response.data; // 假设后端返回的是一个价格\r\n          console.log(this.price)\r\n        } catch (err) {\r\n          this.error = '无法加载预计价格，请稍等';\r\n        }\r\n    },\r\n    async handleSubmit() {\r\n      try {\r\n        this.isSubmitting = true;\r\n        this.error = null;\r\n\r\n        const formData = new FormData();\r\n        formData.append('name', this.formData.name);\r\n        // 曝光量必须是商品广告\r\n        formData.append('ps_id', this.convertToInt(this.formData.selectedProduct));\r\n        formData.append('type', 'product');\r\n        formData.append('start_time', null);\r\n        formData.append('end_time', null);\r\n        formData.append('times', this.convertToInt(this.formData.times));\r\n        formData.append('price', this.convertToFloat(this.formData.price));\r\n        formData.append('banner', false);\r\n\r\n        // 添加文件（如果有）\r\n        if (this.formData.picture) {\r\n          formData.append('picture', this.formData.picture); // 使用正确的键名 'pictrue'\r\n        }\r\n\r\n        // 发送请求到服务器\r\n        const response = await axios.post('http://localhost:8081/advertise/create', formData);\r\n\r\n        console.log(response);\r\n        console.log('Form submitted:', formData);\r\n        this.$emit('adAdded', { ...this.formData });\r\n        this.clearForm();\r\n      } catch (err) {\r\n        this.error = err.message || '发生错误，请稍后再试';\r\n      } finally {\r\n        this.isSubmitting = false;\r\n      }\r\n    },\r\n    clearForm() {\r\n      this.formData = {\r\n        ps_id: null,\r\n        name: '',\r\n        start_time: null,\r\n        end_time: null,\r\n        price: null,\r\n        picture: null,\r\n      };\r\n      // 手动清除文件输入框\r\n      this.$refs.pictureInput.value = null;\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.add-ad-form {\r\n  padding: 20px;\r\n  background-color: #fff;\r\n  border-radius: 8px;\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n  max-height: calc(80vh - 100px);\r\n  overflow-y: auto; /* 当内容超出容器的高度时，允许垂直滚动 */\r\n\r\n  h2 {\r\n    margin-top: 0;\r\n    font-size: 1.5em;\r\n    color: #ff6700;\r\n  }\r\n\r\n  .form-group {\r\n    margin-bottom: 1rem;\r\n\r\n    label {\r\n      display: block;\r\n      margin-bottom: 0.5rem;\r\n      font-weight: bold;\r\n    }\r\n\r\n    input, textarea, select {\r\n      width: 90%;\r\n      padding: 0.5rem;\r\n      border: 1px solid #ccc;\r\n      border-radius: 4px;\r\n      transition: border-color 0.3s ease;\r\n\r\n      &:focus {\r\n        outline: none;\r\n        border-color: #ff6700;\r\n      }\r\n    }\r\n\r\n    textarea {\r\n      resize: vertical;\r\n    }\r\n    .error{\r\n      display: inline-block;\r\n    }\r\n   input.radio-group {\r\n      display: inline-block;\r\n      max-width: 10px; \r\n   }\r\n  }\r\n\r\n  button {\r\n    padding: 0.75rem 1.5rem;\r\n    border: none;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n    color: #fff;\r\n    background-color: #ff6700;\r\n    transition: background-color 0.3s ease;\r\n\r\n    &:hover:not(:disabled) {\r\n      background-color: darken(#ff6700, 10%);\r\n    }\r\n\r\n    &[disabled] {\r\n      opacity: 0.65;\r\n      cursor: not-allowed;\r\n    }\r\n  }\r\n\r\n  .error {\r\n    margin-top: 1rem;\r\n    color: red;\r\n  }\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}