{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from 'axios';\nexport default {\n  name: 'ForgetPasswordView',\n  data() {\n    const validateConfirmPassword = (rule, value, callback) => {\n      if (value !== this.formData.newPassword) {\n        callback(new Error('两次输入的密码不一致'));\n      } else {\n        callback();\n      }\n    };\n    return {\n      currentStep: 0,\n      loading: false,\n      isCodeSent: false,\n      countdown: 60,\n      timer: null,\n      emailFound: false,\n      formData: {\n        username: '',\n        email: '',\n        verificationCode: '',\n        newPassword: '',\n        confirmPassword: ''\n      },\n      rules: {\n        username: [{\n          required: true,\n          message: '请输入用户名',\n          trigger: 'blur'\n        }],\n        email: [{\n          required: true,\n          message: '请输入邮箱',\n          trigger: 'blur'\n        }, {\n          type: 'email',\n          message: '请输入正确的邮箱格式',\n          trigger: 'blur'\n        }],\n        verificationCode: [{\n          required: true,\n          message: '请输入验证码',\n          trigger: 'blur'\n        }],\n        newPassword: [{\n          required: true,\n          message: '请输入新密码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          message: '密码长度不能小于6位',\n          trigger: 'blur'\n        }],\n        confirmPassword: [{\n          required: true,\n          message: '请确认密码',\n          trigger: 'blur'\n        }, {\n          validator: validateConfirmPassword,\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  computed: {\n    canSendCode() {\n      return this.formData.username && this.formData.email && !this.isCodeSent;\n    },\n    codeButtonText() {\n      return this.isCodeSent ? `${this.countdown}秒后重试` : '发送验证码';\n    }\n  },\n  methods: {\n    async checkUsername() {\n      if (!this.formData.username) return;\n      try {\n        const response = await axios.get(`http://localhost:8081/users/check/${this.formData.username}`);\n        if (response.data.status === 'success') {\n          this.formData.email = response.data.email;\n          this.emailFound = true;\n          return true;\n        } else {\n          this.emailFound = false;\n          this.formData.email = '';\n        }\n        return false;\n      } catch (error) {\n        this.emailFound = false;\n        this.formData.email = '';\n        return false;\n      }\n    },\n    async sendVerificationCode() {\n      try {\n        const response = await axios.post('http://localhost:8081/users/sendResetCode', {\n          username: this.formData.username,\n          email: this.formData.email\n        });\n        if (response.data.status === 'success') {\n          this.$message.success('验证码已发送');\n          this.startCountdown();\n        } else {\n          this.$message.error(response.data.message || '发送验证码失败');\n        }\n      } catch (error) {\n        console.error('发送验证码失败:', error);\n        this.$message.error('发送验证码失败');\n      }\n    },\n    startCountdown() {\n      this.isCodeSent = true;\n      this.countdown = 60;\n      if (this.timer) {\n        clearInterval(this.timer);\n      }\n      this.timer = setInterval(() => {\n        if (this.countdown > 0) {\n          this.countdown--;\n        } else {\n          this.isCodeSent = false;\n          clearInterval(this.timer);\n        }\n      }, 1000);\n    },\n    async verifyIdentity() {\n      try {\n        await this.$refs.verifyForm.validate();\n        const response = await axios.post('http://localhost:8081/users/verifyResetCode', {\n          username: this.formData.username,\n          code: this.formData.verificationCode\n        });\n        if (response.data.status === 'success') {\n          this.currentStep = 1;\n        } else {\n          this.$message.error('验证码错误');\n        }\n      } catch (error) {\n        console.error('验证失败:', error);\n        this.$message.error('验证失败');\n      }\n    },\n    async resetPassword() {\n      try {\n        await this.$refs.passwordForm.validate();\n        this.loading = true;\n        console.log('Resetting password for:', {\n          username: this.formData.username,\n          newPassword: this.formData.newPassword\n        });\n        const response = await axios.post('http://localhost:8081/users/resetPassword', {\n          username: this.formData.username,\n          newPassword: this.formData.newPassword\n        });\n        console.log('Reset password response:', response.data);\n        if (response.data.status === 'success') {\n          this.$message.success('密码重置成功');\n          this.currentStep = 2;\n        } else {\n          this.$message.error(response.data.message || '重置密码失败');\n        }\n      } catch (error) {\n        console.error('Reset password error:', error);\n        this.$message.error(error.response?.data?.message || '重置密码失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    goToLogin() {\n      this.$router.push('/login');\n    }\n  },\n  beforeDestroy() {\n    if (this.timer) {\n      clearInterval(this.timer);\n    }\n  }\n};","map":{"version":3,"names":["axios","name","data","validateConfirmPassword","rule","value","callback","formData","newPassword","Error","currentStep","loading","isCodeSent","countdown","timer","emailFound","username","email","verificationCode","confirmPassword","rules","required","message","trigger","type","min","validator","computed","canSendCode","codeButtonText","methods","checkUsername","response","get","status","error","sendVerificationCode","post","$message","success","startCountdown","console","clearInterval","setInterval","verifyIdentity","$refs","verifyForm","validate","code","resetPassword","passwordForm","log","goToLogin","$router","push","beforeDestroy"],"sources":["src/views/ForgetPasswordView.vue"],"sourcesContent":["<template>\r\n  <div class=\"forget-password-page\">\r\n    <div class=\"forget-password-container\">\r\n      <h2>重置密码</h2>\r\n      <el-steps :active=\"currentStep\" finish-status=\"success\" simple style=\"margin: 20px 0\">\r\n        <el-step title=\"验证身份\"></el-step>\r\n        <el-step title=\"重置密码\"></el-step>\r\n        <el-step title=\"完成\"></el-step>\r\n      </el-steps>\r\n\r\n      <!-- 步骤1：验证身份 -->\r\n      <div v-if=\"currentStep === 0\" class=\"step-content\">\r\n        <el-form :model=\"formData\" :rules=\"rules\" ref=\"verifyForm\">\r\n          <el-form-item prop=\"username\" label=\"用户名\">\r\n            <el-input \r\n              v-model=\"formData.username\" \r\n              placeholder=\"请输入用户名\"\r\n              @blur=\"checkUsername\"\r\n            ></el-input>\r\n          </el-form-item>\r\n          <el-form-item prop=\"email\" label=\"邮箱\">\r\n            <el-input \r\n              v-model=\"formData.email\" \r\n              placeholder=\"请输入邮箱\"\r\n              :disabled=\"emailFound\"\r\n            ></el-input>\r\n          </el-form-item>\r\n          <el-form-item prop=\"verificationCode\" label=\"验证码\">\r\n            <div class=\"verification-code\">\r\n              <el-input \r\n                v-model=\"formData.verificationCode\" \r\n                placeholder=\"请输入验证码\"\r\n                :maxlength=\"6\"\r\n                class=\"code-input\"\r\n              >\r\n              </el-input>\r\n              <el-button \r\n                type=\"primary\" \r\n                :disabled=\"!canSendCode\"\r\n                @click=\"sendVerificationCode\"\r\n                size=\"small\"\r\n                class=\"send-code-btn\"\r\n              >\r\n                {{ codeButtonText }}\r\n              </el-button>\r\n            </div>\r\n          </el-form-item>\r\n          <el-button type=\"primary\" @click=\"verifyIdentity\" :loading=\"loading\">下一步</el-button>\r\n        </el-form>\r\n      </div>\r\n\r\n      <!-- 步骤2：重置密码 -->\r\n      <div v-if=\"currentStep === 1\" class=\"step-content\">\r\n        <el-form :model=\"formData\" :rules=\"rules\" ref=\"passwordForm\">\r\n          <el-form-item prop=\"newPassword\" label=\"新密码\">\r\n            <el-input \r\n              type=\"password\" \r\n              v-model=\"formData.newPassword\" \r\n              placeholder=\"请输入新密码\"\r\n            ></el-input>\r\n          </el-form-item>\r\n          <el-form-item prop=\"confirmPassword\" label=\"确认密码\">\r\n            <el-input \r\n              type=\"password\" \r\n              v-model=\"formData.confirmPassword\" \r\n              placeholder=\"请再次输入新密码\"\r\n            ></el-input>\r\n          </el-form-item>\r\n          <el-button type=\"primary\" @click=\"resetPassword\" :loading=\"loading\">确认重置</el-button>\r\n        </el-form>\r\n      </div>\r\n\r\n      <!-- 步骤3：完成 -->\r\n      <div v-if=\"currentStep === 2\" class=\"step-content\">\r\n        <div class=\"success-message\">\r\n          <i class=\"el-icon-success\"></i>\r\n          <h3>密码重置成功</h3>\r\n          <p>请使用新密码登录</p>\r\n          <el-button type=\"primary\" @click=\"goToLogin\">返回登录</el-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\n\r\nexport default {\r\n  name: 'ForgetPasswordView',\r\n  data() {\r\n    const validateConfirmPassword = (rule, value, callback) => {\r\n      if (value !== this.formData.newPassword) {\r\n        callback(new Error('两次输入的密码不一致'));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n\r\n    return {\r\n      currentStep: 0,\r\n      loading: false,\r\n      isCodeSent: false,\r\n      countdown: 60,\r\n      timer: null,\r\n      emailFound: false,\r\n      formData: {\r\n        username: '',\r\n        email: '',\r\n        verificationCode: '',\r\n        newPassword: '',\r\n        confirmPassword: ''\r\n      },\r\n      rules: {\r\n        username: [\r\n          { required: true, message: '请输入用户名', trigger: 'blur' }\r\n        ],\r\n        email: [\r\n          { required: true, message: '请输入邮箱', trigger: 'blur' },\r\n          { type: 'email', message: '请输入正确的邮箱格式', trigger: 'blur' }\r\n        ],\r\n        verificationCode: [\r\n          { required: true, message: '请输入验证码', trigger: 'blur' }\r\n        ],\r\n        newPassword: [\r\n          { required: true, message: '请输入新密码', trigger: 'blur' },\r\n          { min: 6, message: '密码长度不能小于6位', trigger: 'blur' }\r\n        ],\r\n        confirmPassword: [\r\n          { required: true, message: '请确认密码', trigger: 'blur' },\r\n          { validator: validateConfirmPassword, trigger: 'blur' }\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    canSendCode() {\r\n      return this.formData.username && \r\n             this.formData.email && \r\n             !this.isCodeSent;\r\n    },\r\n    codeButtonText() {\r\n      return this.isCodeSent ? `${this.countdown}秒后重试` : '发送验证码';\r\n    }\r\n  },\r\n  methods: {\r\n    async checkUsername() {\r\n      if (!this.formData.username) return;\r\n      \r\n      try {\r\n        const response = await axios.get(`http://localhost:8081/users/check/${this.formData.username}`);\r\n        if (response.data.status === 'success') {\r\n          this.formData.email = response.data.email;\r\n          this.emailFound = true;\r\n          return true;\r\n        } else {\r\n          this.emailFound = false;\r\n          this.formData.email = '';\r\n        }\r\n        return false;\r\n      } catch (error) {\r\n        this.emailFound = false;\r\n        this.formData.email = '';\r\n        return false;\r\n      }\r\n    },\r\n    async sendVerificationCode() {\r\n      try {\r\n        const response = await axios.post('http://localhost:8081/users/sendResetCode', {\r\n          username: this.formData.username,\r\n          email: this.formData.email\r\n        });\r\n        \r\n        if (response.data.status === 'success') {\r\n          this.$message.success('验证码已发送');\r\n          this.startCountdown();\r\n        } else {\r\n          this.$message.error(response.data.message || '发送验证码失败');\r\n        }\r\n      } catch (error) {\r\n        console.error('发送验证码失败:', error);\r\n        this.$message.error('发送验证码失败');\r\n      }\r\n    },\r\n    startCountdown() {\r\n      this.isCodeSent = true;\r\n      this.countdown = 60;\r\n      if (this.timer) {\r\n        clearInterval(this.timer);\r\n      }\r\n      this.timer = setInterval(() => {\r\n        if (this.countdown > 0) {\r\n          this.countdown--;\r\n        } else {\r\n          this.isCodeSent = false;\r\n          clearInterval(this.timer);\r\n        }\r\n      }, 1000);\r\n    },\r\n    async verifyIdentity() {\r\n      try {\r\n        await this.$refs.verifyForm.validate();\r\n        \r\n        const response = await axios.post('http://localhost:8081/users/verifyResetCode', {\r\n          username: this.formData.username,\r\n          code: this.formData.verificationCode\r\n        });\r\n        \r\n        if (response.data.status === 'success') {\r\n          this.currentStep = 1;\r\n        } else {\r\n          this.$message.error('验证码错误');\r\n        }\r\n      } catch (error) {\r\n        console.error('验证失败:', error);\r\n        this.$message.error('验证失败');\r\n      }\r\n    },\r\n    async resetPassword() {\r\n      try {\r\n        await this.$refs.passwordForm.validate();\r\n        \r\n        this.loading = true;\r\n        console.log('Resetting password for:', {\r\n          username: this.formData.username,\r\n          newPassword: this.formData.newPassword\r\n        });\r\n\r\n        const response = await axios.post('http://localhost:8081/users/resetPassword', {\r\n          username: this.formData.username,\r\n          newPassword: this.formData.newPassword\r\n        });\r\n        \r\n        console.log('Reset password response:', response.data);\r\n        \r\n        if (response.data.status === 'success') {\r\n          this.$message.success('密码重置成功');\r\n          this.currentStep = 2;\r\n        } else {\r\n          this.$message.error(response.data.message || '重置密码失败');\r\n        }\r\n      } catch (error) {\r\n        console.error('Reset password error:', error);\r\n        this.$message.error(error.response?.data?.message || '重置密码失败');\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    goToLogin() {\r\n      this.$router.push('/login');\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    if (this.timer) {\r\n      clearInterval(this.timer);\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.forget-password-page {\r\n  min-height: calc(100vh - 120px);\r\n  background-color: #f5f5f5;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 40px 0;\r\n}\r\n\r\n.forget-password-container {\r\n  background: white;\r\n  padding: 40px;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\r\n  width: 100%;\r\n  max-width: 500px;\r\n\r\n  h2 {\r\n    text-align: center;\r\n    margin-bottom: 30px;\r\n    color: #333;\r\n  }\r\n}\r\n\r\n.step-content {\r\n  margin-top: 30px;\r\n}\r\n\r\n.verification-code {\r\n  display: flex;\r\n  gap: 10px;\r\n  align-items: center;\r\n\r\n  .code-input {\r\n    width: 200px;\r\n    \r\n    ::v-deep .el-input__inner {\r\n      text-align: center;\r\n      letter-spacing: 2px;\r\n    }\r\n  }\r\n\r\n  .send-code-btn {\r\n    width: 95px;\r\n    padding: 9px 10px;\r\n    font-size: 12px;\r\n  }\r\n}\r\n\r\n.success-message {\r\n  text-align: center;\r\n  padding: 30px 0;\r\n\r\n  i {\r\n    font-size: 60px;\r\n    color: #67C23A;\r\n    margin-bottom: 20px;\r\n  }\r\n\r\n  h3 {\r\n    margin: 20px 0 10px;\r\n    color: #333;\r\n  }\r\n\r\n  p {\r\n    color: #666;\r\n    margin-bottom: 20px;\r\n  }\r\n}\r\n\r\n.el-form {\r\n  .el-button {\r\n    width: 100%;\r\n    margin-top: 20px;\r\n  }\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}