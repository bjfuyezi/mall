{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport axios from 'axios';\nexport default {\n  data() {\n    return {\n      shop_id: 4,\n      // session获取\n      product: {\n        name: '',\n        category: '',\n        price: null,\n        description: '',\n        stock: [],\n        unit: '',\n        notice: '',\n        images: [] // 存储图片信息\n      },\n      categories: ['生鲜食品', '零食小吃', '酒水饮料', '干货腌货', '即食食品', '农产品']\n    };\n  },\n  methods: {\n    addStock() {\n      if (this.product.stock.length < 5) {\n        this.product.stock.push({\n          flavor: '',\n          quantity: 0\n        });\n      }\n    },\n    removeStock(index) {\n      this.product.stock.splice(index, 1);\n    },\n    addImage() {\n      if (this.product.images.length < 5) {\n        this.product.images.push({\n          file: null,\n          previewUrl: null\n        });\n      }\n    },\n    handleImageUpload(event, index) {\n      const file = event.target.files[0];\n      if (file) {\n        const fileType = file.type;\n        const fileSize = file.size;\n\n        // 验证文件类型和大小\n        if (['image/jpeg', 'image/png'].includes(fileType) && fileSize <= 20 * 1024 * 1024) {\n          // 限制大小为5MB以内\n          const reader = new FileReader();\n          reader.onload = e => {\n            this.$set(this.product.images, index, {\n              file: file,\n              preview: e.target.result\n            });\n          };\n          reader.readAsDataURL(file);\n        } else {\n          alert(\"只支持上传 jpg, jpeg, png 格式的图片，并且大小不能超过 20MB！\");\n        }\n      }\n    },\n    removeImage(index) {\n      this.product.images.splice(index, 1);\n    },\n    submitForm() {\n      // 准备表单数据\n      const formData = new FormData();\n      formData.append('name', this.product.name);\n      formData.append('category', this.product.category);\n      formData.append('price', this.product.price);\n      formData.append('description', this.product.description);\n      formData.append('unit', this.product.unit);\n      formData.append('notice', this.product.notice);\n\n      // 将库存信息（每个口味和数量）添加到 FormData 中\n      this.product.stock.forEach((stock, index) => {\n        formData.append(`stock[${index}][flavor]`, stock.flavor);\n        formData.append(`stock[${index}][quantity]`, stock.quantity);\n      });\n\n      // 将图片信息添加到 FormData 中（最多5个文件）\n      this.product.images.forEach((image, index) => {\n        if (image.file) {\n          formData.append(`images[${index}]`, image.file); // 传递文件\n        }\n      });\n      axios.post('http://localhost:8081/product/addProduct', formData).then(response => {\n        if (response.status === 200) {\n          alert('申请成功');\n          window.location.reload();\n        }\n      }).catch(error => {\n        console.error('申请失败', error);\n      });\n    }\n  }\n};","map":{"version":3,"names":["axios","data","shop_id","product","name","category","price","description","stock","unit","notice","images","categories","methods","addStock","length","push","flavor","quantity","removeStock","index","splice","addImage","file","previewUrl","handleImageUpload","event","target","files","fileType","type","fileSize","size","includes","reader","FileReader","onload","e","$set","preview","result","readAsDataURL","alert","removeImage","submitForm","formData","FormData","append","forEach","image","post","then","response","status","window","location","reload","catch","error","console"],"sources":["src/views/shopmodel/AddProduct.vue"],"sourcesContent":["<template>\r\n    <div class=\"create-product\">\r\n      <h2>创建商品</h2>\r\n      <form @submit.prevent=\"submitForm\" class=\"product-form\">\r\n        <!-- 商品名称 -->\r\n        <div class=\"form-group\">\r\n          <label for=\"productName\">商品名称</label>\r\n          <input v-model=\"product.name\" type=\"text\" id=\"productName\" required />\r\n        </div>\r\n  \r\n        <!-- 商品类别 -->\r\n        <div class=\"form-group\">\r\n          <label for=\"category\">类别</label>\r\n          <select v-model=\"product.category\" id=\"category\" required>\r\n            <option v-for=\"category in categories\" :key=\"category\" :value=\"category\">\r\n              {{ category }}\r\n            </option>\r\n          </select>\r\n        </div>\r\n  \r\n        <!-- 定价 -->\r\n        <div class=\"form-group\">\r\n          <label for=\"price\">定价</label>\r\n          <input v-model=\"product.price\" type=\"number\" id=\"price\" min=\"0\" required />\r\n        </div>\r\n  \r\n        <!-- 商品描述 -->\r\n        <div class=\"form-group\">\r\n          <label for=\"description\">商品描述</label>\r\n          <textarea v-model=\"product.description\" id=\"description\" required></textarea>\r\n        </div>\r\n  \r\n        <!-- 初始库存量 -->\r\n        <div class=\"form-group\">\r\n          <label for=\"stock\">初始库存量</label>\r\n          <div class=\"stock-tags\">\r\n            <div v-for=\"(stock, index) in product.stock\" :key=\"index\" class=\"stock-tag\">\r\n              <input v-model=\"stock.flavor\" placeholder=\"口味\" />\r\n              <input v-model=\"stock.quantity\" type=\"number\" min=\"0\" placeholder=\"库存量\" />\r\n              <button type=\"button\" @click=\"removeStock(index)\">移除</button>\r\n            </div>\r\n            <button type=\"button\" @click=\"addStock\" :disabled=\"product.stock.length >= 5\">添加组合标签</button>\r\n          </div>\r\n        </div>\r\n  \r\n        <!-- 售卖单位 -->\r\n        <div class=\"form-group\">\r\n          <label for=\"unit\">售卖单位</label>\r\n          <input v-model=\"product.unit\" type=\"text\" id=\"unit\" required />\r\n        </div>\r\n  \r\n        <!-- 注意事项 -->\r\n        <div class=\"form-group\">\r\n          <label for=\"notice\">注意事项</label>\r\n          <textarea v-model=\"product.notice\" id=\"notice\" required></textarea>\r\n        </div>\r\n  \r\n        <!-- 商品图片上传 -->\r\n        <div class=\"form-group\">\r\n          <label for=\"productImages\">商品图片</label>\r\n          <div class=\"image-upload-container\">\r\n            <input \r\n              type=\"file\" \r\n              accept=\"image/*\"\r\n              v-for=\"(image, index) in product.images\" \r\n              :key=\"index\"\r\n              :id=\"'image-' + index\"\r\n              @change=\"handleImageUpload($event, index)\"\r\n              :disabled=\"product.images.length >= 5\"\r\n            />\r\n            <button type=\"button\" @click=\"addImage\" :disabled=\"product.images.length >= 5\">添加图片</button>\r\n          </div>\r\n          <div class=\"image-previews\">\r\n            <div v-for=\"(image, index) in product.images\" :key=\"'preview-' + index\" class=\"image-preview\">\r\n              <img :src=\"image.previewUrl\" :alt=\"'preview-' + index\" />\r\n              <button type=\"button\" @click=\"removeImage(index)\">移除</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n  \r\n        <!-- 提交按钮 -->\r\n        <div class=\"form-group\">\r\n          <button type=\"submit\" class=\"submit-button\">申请上架</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import axios from 'axios';\r\n\r\n  export default {\r\n    data() {\r\n      return {\r\n        shop_id: 4,     // session获取\r\n        product: {\r\n          name: '',\r\n          category: '',\r\n          price: null,\r\n          description: '',\r\n          stock: [],\r\n          unit: '',\r\n          notice: '',\r\n          images: [], // 存储图片信息\r\n        },\r\n        categories: [\r\n          '生鲜食品', '零食小吃', '酒水饮料', '干货腌货', '即食食品', '农产品'\r\n        ],\r\n      };\r\n    },\r\n    methods: {\r\n      addStock() {\r\n        if (this.product.stock.length < 5) {\r\n          this.product.stock.push({ flavor: '', quantity: 0 });\r\n        }\r\n      },\r\n      removeStock(index) {\r\n        this.product.stock.splice(index, 1);\r\n      },\r\n      addImage() {\r\n        if (this.product.images.length < 5) {\r\n          this.product.images.push({ file: null, previewUrl: null });\r\n        }\r\n      },\r\n      handleImageUpload(event, index) {\r\n        const file = event.target.files[0];\r\n\r\n        if (file) {\r\n            const fileType = file.type;\r\n            const fileSize = file.size;\r\n\r\n            // 验证文件类型和大小\r\n            if (['image/jpeg', 'image/png'].includes(fileType) && fileSize <= 20 * 1024 * 1024) { // 限制大小为5MB以内\r\n            const reader = new FileReader();\r\n            reader.onload = (e) => {\r\n                this.$set(this.product.images, index, {\r\n                file: file,\r\n                preview: e.target.result\r\n                });\r\n            };\r\n            reader.readAsDataURL(file);\r\n            } else {\r\n                alert(\"只支持上传 jpg, jpeg, png 格式的图片，并且大小不能超过 20MB！\");\r\n            }\r\n        }\r\n      },\r\n      removeImage(index) {\r\n        this.product.images.splice(index, 1);\r\n      },\r\n      submitForm() {\r\n        // 准备表单数据\r\n        const formData = new FormData();\r\n        formData.append('name', this.product.name);\r\n        formData.append('category', this.product.category);\r\n        formData.append('price', this.product.price);\r\n        formData.append('description', this.product.description);\r\n        formData.append('unit', this.product.unit);\r\n        formData.append('notice', this.product.notice);\r\n\r\n        // 将库存信息（每个口味和数量）添加到 FormData 中\r\n        this.product.stock.forEach((stock, index) => {\r\n            formData.append(`stock[${index}][flavor]`, stock.flavor);\r\n            formData.append(`stock[${index}][quantity]`, stock.quantity);\r\n        });\r\n\r\n        // 将图片信息添加到 FormData 中（最多5个文件）\r\n        this.product.images.forEach((image, index) => {\r\n            if (image.file) {\r\n            formData.append(`images[${index}]`, image.file); // 传递文件\r\n            }\r\n        });\r\n\r\n        axios.post('http://localhost:8081/product/addProduct', formData)\r\n            .then(response => {\r\n              if ( response.status === 200 ){\r\n                alert('申请成功');\r\n                window.location.reload();\r\n              }\r\n            })\r\n            .catch(error => {\r\n              console.error('申请失败', error);\r\n            });\r\n      }\r\n    }\r\n  };\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .create-product {\r\n    width: 100%;\r\n    max-width: 600px;\r\n    margin: 0 auto;\r\n  }\r\n  \r\n  .product-form {\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n  \r\n  .form-group {\r\n    margin-bottom: 20px;\r\n  }\r\n  \r\n  .form-group label {\r\n    display: block;\r\n    font-weight: bold;\r\n    margin-bottom: 5px;\r\n  }\r\n  \r\n  input, select, textarea {\r\n    width: 100%;\r\n    padding: 10px;\r\n    font-size: 14px;\r\n    border: 1px solid #ccc;\r\n    border-radius: 5px;\r\n  }\r\n  \r\n  textarea {\r\n    resize: vertical;\r\n    min-height: 100px;\r\n  }\r\n  \r\n  .stock-tags {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 10px;\r\n  }\r\n  \r\n  .stock-tag {\r\n    display: flex;\r\n    gap: 10px;\r\n    align-items: center;\r\n  }\r\n  \r\n  .stock-tag input {\r\n    flex: 1;\r\n  }\r\n  \r\n  button {\r\n    background-color: #ff6700;\r\n    color: white;\r\n    border: none;\r\n    padding: 5px 10px;\r\n    cursor: pointer;\r\n    border-radius: 5px;\r\n  }\r\n  \r\n  button:disabled {\r\n    background-color: #ccc;\r\n    cursor: not-allowed;\r\n  }\r\n  \r\n  .submit-button {\r\n    background-color: #4CAF50;\r\n    color: white;\r\n    border: none;\r\n    padding: 10px;\r\n    font-size: 16px;\r\n    cursor: pointer;\r\n    border-radius: 5px;\r\n  }\r\n  \r\n  .submit-button:hover {\r\n    background-color: #45a049;\r\n  }\r\n  \r\n  /* 图片上传部分样式 */\r\n  .image-upload-container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 10px;\r\n  }\r\n  \r\n  .image-previews {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 10px;\r\n  }\r\n  \r\n  .image-preview {\r\n    position: relative;\r\n  }\r\n  \r\n  .image-preview img {\r\n    width: 100px;\r\n    height: 100px;\r\n    object-fit: cover;\r\n    border-radius: 5px;\r\n  }\r\n  \r\n  .image-preview button {\r\n    position: absolute;\r\n    top: 5px;\r\n    right: 5px;\r\n    background-color: rgba(0, 0, 0, 0.5);\r\n    color: white;\r\n    border: none;\r\n    padding: 2px 5px;\r\n    border-radius: 50%;\r\n    cursor: pointer;\r\n  }\r\n  </style>\r\n  "],"mappings":";;;AAyFA,OAAAA,KAAA;AAEA;EACAC,KAAA;IACA;MACAC,OAAA;MAAA;MACAC,OAAA;QACAC,IAAA;QACAC,QAAA;QACAC,KAAA;QACAC,WAAA;QACAC,KAAA;QACAC,IAAA;QACAC,MAAA;QACAC,MAAA;MACA;MACAC,UAAA,GACA;IAEA;EACA;EACAC,OAAA;IACAC,SAAA;MACA,SAAAX,OAAA,CAAAK,KAAA,CAAAO,MAAA;QACA,KAAAZ,OAAA,CAAAK,KAAA,CAAAQ,IAAA;UAAAC,MAAA;UAAAC,QAAA;QAAA;MACA;IACA;IACAC,YAAAC,KAAA;MACA,KAAAjB,OAAA,CAAAK,KAAA,CAAAa,MAAA,CAAAD,KAAA;IACA;IACAE,SAAA;MACA,SAAAnB,OAAA,CAAAQ,MAAA,CAAAI,MAAA;QACA,KAAAZ,OAAA,CAAAQ,MAAA,CAAAK,IAAA;UAAAO,IAAA;UAAAC,UAAA;QAAA;MACA;IACA;IACAC,kBAAAC,KAAA,EAAAN,KAAA;MACA,MAAAG,IAAA,GAAAG,KAAA,CAAAC,MAAA,CAAAC,KAAA;MAEA,IAAAL,IAAA;QACA,MAAAM,QAAA,GAAAN,IAAA,CAAAO,IAAA;QACA,MAAAC,QAAA,GAAAR,IAAA,CAAAS,IAAA;;QAEA;QACA,gCAAAC,QAAA,CAAAJ,QAAA,KAAAE,QAAA;UAAA;UACA,MAAAG,MAAA,OAAAC,UAAA;UACAD,MAAA,CAAAE,MAAA,GAAAC,CAAA;YACA,KAAAC,IAAA,MAAAnC,OAAA,CAAAQ,MAAA,EAAAS,KAAA;cACAG,IAAA,EAAAA,IAAA;cACAgB,OAAA,EAAAF,CAAA,CAAAV,MAAA,CAAAa;YACA;UACA;UACAN,MAAA,CAAAO,aAAA,CAAAlB,IAAA;QACA;UACAmB,KAAA;QACA;MACA;IACA;IACAC,YAAAvB,KAAA;MACA,KAAAjB,OAAA,CAAAQ,MAAA,CAAAU,MAAA,CAAAD,KAAA;IACA;IACAwB,WAAA;MACA;MACA,MAAAC,QAAA,OAAAC,QAAA;MACAD,QAAA,CAAAE,MAAA,cAAA5C,OAAA,CAAAC,IAAA;MACAyC,QAAA,CAAAE,MAAA,kBAAA5C,OAAA,CAAAE,QAAA;MACAwC,QAAA,CAAAE,MAAA,eAAA5C,OAAA,CAAAG,KAAA;MACAuC,QAAA,CAAAE,MAAA,qBAAA5C,OAAA,CAAAI,WAAA;MACAsC,QAAA,CAAAE,MAAA,cAAA5C,OAAA,CAAAM,IAAA;MACAoC,QAAA,CAAAE,MAAA,gBAAA5C,OAAA,CAAAO,MAAA;;MAEA;MACA,KAAAP,OAAA,CAAAK,KAAA,CAAAwC,OAAA,EAAAxC,KAAA,EAAAY,KAAA;QACAyB,QAAA,CAAAE,MAAA,UAAA3B,KAAA,aAAAZ,KAAA,CAAAS,MAAA;QACA4B,QAAA,CAAAE,MAAA,UAAA3B,KAAA,eAAAZ,KAAA,CAAAU,QAAA;MACA;;MAEA;MACA,KAAAf,OAAA,CAAAQ,MAAA,CAAAqC,OAAA,EAAAC,KAAA,EAAA7B,KAAA;QACA,IAAA6B,KAAA,CAAA1B,IAAA;UACAsB,QAAA,CAAAE,MAAA,WAAA3B,KAAA,KAAA6B,KAAA,CAAA1B,IAAA;QACA;MACA;MAEAvB,KAAA,CAAAkD,IAAA,6CAAAL,QAAA,EACAM,IAAA,CAAAC,QAAA;QACA,IAAAA,QAAA,CAAAC,MAAA;UACAX,KAAA;UACAY,MAAA,CAAAC,QAAA,CAAAC,MAAA;QACA;MACA,GACAC,KAAA,CAAAC,KAAA;QACAC,OAAA,CAAAD,KAAA,SAAAA,KAAA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}