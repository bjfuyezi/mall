{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from 'axios';\nexport default {\n  data() {\n    return {\n      user_id: 1,\n      shopStatus: '',\n      isProcessing: false,\n      // 用于防止重复点击\n      picture: null,\n      reason: '',\n      url: '',\n      shopInfo: {\n        shop_id: '',\n        shopName: '',\n        description: '',\n        createdTime: '',\n        location: '',\n        level: '',\n        salary: '',\n        salenum: ''\n      }\n    };\n  },\n  computed: {\n    isFormDisabled() {\n      return this.shopStatus === 'waiting' || this.isProcessing;\n    }\n  },\n  created() {\n    // 页面加载时获取店铺信息\n    this.fetchShopDetails();\n  },\n  methods: {\n    // 获取店铺信息\n    async fetchShopDetails() {\n      this.isProcessing = true;\n      try {\n        const response = await axios.post('http://localhost:8081/shop/getByUser_id', {\n          id: this.user_id\n        });\n        if (response.data) {\n          const shopData = response.data;\n          this.shopStatus = shopData.status;\n          if (shopData.reason) this.reason = shopData.reason;\n          this.shopInfo = {\n            shop_id: shopData.shop_id,\n            shopName: shopData.shop_name,\n            description: shopData.shop_description,\n            createdTime: shopData.created_time,\n            location: shopData.location,\n            level: shopData.level,\n            salary: shopData.salary\n          };\n          // 获取总销量\n          const saleResponse = await axios.post('http://localhost:8081/product/getSalenumByShop_id', {\n            id: shopData.shop_id\n          });\n          if (saleResponse.data != null) {\n            this.shopInfo.salenum = saleResponse.data;\n          }\n          // 根据 picture_id 获取图片\n          const pictureId = shopData.picture_id; // 假设图片ID是返回数据中的字段\n          if (pictureId) {\n            const pictureResponse = await axios.post('http://localhost:8081/pic/getUrl', {\n              id: pictureId\n            });\n            if (pictureResponse.data) {\n              this.url = pictureResponse.data;\n            }\n          }\n        }\n      } catch (error) {\n        console.error('提交失败:', error);\n        alert('发生错误，请稍后再试');\n      } finally {\n        this.isProcessing = false;\n      }\n    },\n    // 切换店铺状态（开业/歇业）\n    toggleShopStatus() {\n      if (this.isProcessing) return;\n      this.isProcessing = true;\n      this.shopStatus = this.shopStatus === 'closed' ? 'open' : 'closed';\n      axios.post('http://localhost:8081/shop/status', {\n        id: this.shopInfo.shop_id,\n        status: this.shopStatus\n      }).then(response => {\n        if (response.status === 200) {\n          alert('切换店铺成功');\n          window.location.reload();\n        }\n      }).catch(error => {\n        console.error('切换失败', error);\n      });\n    },\n    // 注销店铺\n    closeShop() {\n      if (this.isProcessing) return;\n      this.isProcessing = true;\n      axios.post('http://localhost:8081/shop/deleteShop', {\n        id: this.shopInfo.shop_id\n      }).then(response => {\n        if (response.status === 200) {\n          alert('删除店铺成功');\n          this.$router.push('/shopmodel/asshop'); // 使用 Vue Router 跳转到成为商家\n        }\n      }).catch(error => {\n        console.error('删除失败', error);\n      });\n    },\n    // 提交修改店铺信息申请\n    submitForm() {\n      if (this.isProcessing) return;\n      this.isProcessing = true;\n      // 提交表单前先检查必要字段\n      if (!this.shopInfo.shopName || !this.shopInfo.description || !this.shopInfo.location) {\n        alert('请填写所有必要的字段并上传图片');\n        return;\n      }\n\n      // 准备表单数据\n      const formData = new FormData();\n      formData.append('shop_name', this.shopInfo.shopName);\n      formData.append('description', this.shopInfo.description);\n      formData.append('location', this.shopInfo.location);\n\n      // 追加图片数据\n      formData.append('picture', this.picture.file);\n      formData.append('shop_id', this.shopInfo.shop_id);\n      axios.post('http://localhost:8081/shop/updateShop', formData).then(response => {\n        if (response.status === 200) {\n          alert('申请成功');\n          window.location.reload();\n        }\n      }).catch(error => {\n        console.error('申请失败', error);\n      });\n    },\n    // 提现功能\n    withdraw() {\n      if (this.isProcessing) return;\n      this.isProcessing = true;\n      // 模拟提现操作\n      setTimeout(() => {\n        alert('提现申请已提交');\n        this.isProcessing = false;\n      }, 1000);\n    },\n    handleFileUpload(event) {\n      const file = event.target.files[0];\n      if (file) {\n        const fileType = file.type;\n        const fileSize = file.size;\n\n        // 验证文件类型和大小\n        if (['image/jpeg', 'image/png'].includes(fileType) && fileSize <= 20 * 1024 * 1024) {\n          // 限制大小为5MB以内\n          const reader = new FileReader();\n          reader.onload = e => {\n            this.picture = {\n              file: file,\n              preview: e.target.result\n            };\n          };\n          reader.readAsDataURL(file);\n        } else {\n          alert(\"只支持上传 jpg, jpeg, png 格式的图片，并且大小不能超过 20MB！\");\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","data","user_id","shopStatus","isProcessing","picture","reason","url","shopInfo","shop_id","shopName","description","createdTime","location","level","salary","salenum","computed","isFormDisabled","created","fetchShopDetails","methods","response","post","id","shopData","status","shop_name","shop_description","created_time","saleResponse","pictureId","picture_id","pictureResponse","error","console","alert","toggleShopStatus","then","window","reload","catch","closeShop","$router","push","submitForm","formData","FormData","append","file","withdraw","setTimeout","handleFileUpload","event","target","files","fileType","type","fileSize","size","includes","reader","FileReader","onload","e","preview","result","readAsDataURL"],"sources":["src/views/shopmodel/ShopInfoView.vue"],"sourcesContent":["<template>\r\n  <div class=\"shop-management\">\r\n    <!-- 顶部状态栏 -->\r\n    <div class=\"status-bar\">\r\n      <span class=\"status-message\">\r\n        <div v-if=\"shopStatus === 'suspended'\">\r\n          <p>您的申请被打回，原因是：</p> {{ reason }}\r\n        </div>\r\n        <div v-else>\r\n          {{ shopStatus === 'closed' ? '您的店铺已歇业' : '您的店铺正在营业中' }}\r\n        </div>\r\n      </span>\r\n      <div class=\"action-buttons\">\r\n        <button @click=\"toggleShopStatus\" :disabled=\"isProcessing\">\r\n          {{ shopStatus === 'closed' ? '开业' : '歇业' }}\r\n        </button>\r\n        <button @click=\"closeShop\" :disabled=\"isProcessing\">注销店铺</button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 中部表单区域 -->\r\n    <div class=\"shop-details\">\r\n      <h2>店铺详情</h2>\r\n      <form @submit.prevent=\"submitForm\">\r\n        <div class=\"form-group\">\r\n          <label for=\"shopName\">店铺名称</label>\r\n          <input v-model=\"shopInfo.shopName\" :disabled=\"isFormDisabled\" type=\"text\" id=\"shopName\" />\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"description\">店铺描述</label>\r\n          <textarea v-model=\"shopInfo.description\" :disabled=\"isFormDisabled\" id=\"description\"></textarea>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>创建时间</label>\r\n          <input v-model=\"shopInfo.createdTime\" disabled type=\"text\" />\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>特产地</label>\r\n          <input v-model=\"shopInfo.location\" :disabled=\"isFormDisabled\" type=\"text\" id=\"location\"/>\r\n        </div>\r\n        <!-- 食品经营许可证 -->\r\n        <div class=\"form-group\">\r\n          <label for=\"picture\">食品经营许可证</label>\r\n          <!-- 显示默认图片，如果用户没有选择图片 -->\r\n          <img v-if=\"this.picture\" :src=\"`http://localhost:8081${this.url}`\" alt=\"Now Image\" width=\"200\" height=\"200\" />\r\n          <input \r\n            type=\"file\" \r\n            id=\"picture\" \r\n            @change=\"handleFileUpload\" \r\n            accept=\".jpg,.jpeg,.png\"\r\n            required\r\n          />\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>店铺等级</label>\r\n          <input v-model=\"shopInfo.level\" disabled type=\"text\" id=\"level\"/>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>店铺营业额</label>\r\n          <input v-model=\"shopInfo.salary\" disabled type=\"text\" id=\"salary\"/>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>总销量</label>\r\n          <input v-model=\"shopInfo.salenum\" disabled type=\"text\" id=\"salenum\"/>\r\n        </div>\r\n\r\n        <!-- 提交按钮和提现按钮 -->\r\n        <div class=\"buttons\">\r\n          <button type=\"submit\" :disabled=\"isFormDisabled\">{{ isFormDisabled ? '您的更改申请正在审核中' : '申请修改信息' }}</button>\r\n          <button type=\"button\" @click=\"withdraw\" :disabled=\"isProcessing\">提现</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\nexport default {\r\n  data() {\r\n    return {\r\n      user_id: 1,\r\n      shopStatus: '', \r\n      isProcessing: false, // 用于防止重复点击\r\n      picture: null,\r\n      reason: '',\r\n      url: '',\r\n      shopInfo: {\r\n        shop_id: '',\r\n        shopName: '',\r\n        description: '',\r\n        createdTime: '',\r\n        location: '',\r\n        level: '',\r\n        salary: '',\r\n        salenum: ''\r\n      }\r\n    };\r\n  },\r\n  computed: {\r\n    isFormDisabled() {\r\n      return this.shopStatus === 'waiting' || this.isProcessing;\r\n    }\r\n  },\r\n  created() {\r\n    // 页面加载时获取店铺信息\r\n    this.fetchShopDetails();\r\n  },\r\n  methods: {\r\n  // 获取店铺信息\r\n    async fetchShopDetails() {\r\n      this.isProcessing = true;\r\n      try {\r\n        const response = await axios.post('http://localhost:8081/shop/getByUser_id', {id:this.user_id});\r\n        if ( response.data ) {\r\n          const shopData = response.data;\r\n          this.shopStatus = shopData.status;\r\n          if (shopData.reason) this.reason = shopData.reason;\r\n          this.shopInfo = {\r\n            shop_id: shopData.shop_id,\r\n            shopName: shopData.shop_name,\r\n            description: shopData.shop_description,\r\n            createdTime: shopData.created_time,\r\n            location: shopData.location,\r\n            level: shopData.level,\r\n            salary: shopData.salary\r\n          };\r\n            // 获取总销量\r\n          const saleResponse = await axios.post('http://localhost:8081/product/getSalenumByShop_id', {id: shopData.shop_id});\r\n          if ( saleResponse.data != null ) {\r\n            this.shopInfo.salenum = saleResponse.data;\r\n          } \r\n          // 根据 picture_id 获取图片\r\n          const pictureId = shopData.picture_id; // 假设图片ID是返回数据中的字段\r\n          if (pictureId) {\r\n            const pictureResponse = await axios.post('http://localhost:8081/pic/getUrl', {id: pictureId});\r\n            if ( pictureResponse.data ) {\r\n                this.url = pictureResponse.data;\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('提交失败:', error);\r\n        alert('发生错误，请稍后再试');\r\n      } finally {\r\n        this.isProcessing = false;\r\n      }\r\n    },\r\n    // 切换店铺状态（开业/歇业）\r\n    toggleShopStatus() {\r\n      if (this.isProcessing) return;\r\n      this.isProcessing = true;\r\n      this.shopStatus = this.shopStatus === 'closed' ? 'open' : 'closed';\r\n      axios.post('http://localhost:8081/shop/status', {id:this.shopInfo.shop_id, status:this.shopStatus})\r\n            .then(response => {\r\n              if ( response.status === 200 ){\r\n                alert('切换店铺成功');\r\n                window.location.reload();\r\n              }\r\n            })\r\n            .catch(error => {\r\n              console.error('切换失败', error);\r\n            });\r\n    },\r\n\r\n    // 注销店铺\r\n    closeShop() {\r\n      if (this.isProcessing) return;\r\n      this.isProcessing = true;\r\n      axios.post('http://localhost:8081/shop/deleteShop', {id:this.shopInfo.shop_id})\r\n            .then(response => {\r\n              if ( response.status === 200 ){\r\n                alert('删除店铺成功');\r\n                this.$router.push('/shopmodel/asshop'); // 使用 Vue Router 跳转到成为商家\r\n              }\r\n            })\r\n            .catch(error => {\r\n              console.error('删除失败', error);\r\n            });\r\n    },\r\n\r\n    // 提交修改店铺信息申请\r\n    submitForm() {\r\n      if (this.isProcessing) return;\r\n      this.isProcessing = true;\r\n      // 提交表单前先检查必要字段\r\n      if (!this.shopInfo.shopName || !this.shopInfo.description || !this.shopInfo.location ) {\r\n        alert('请填写所有必要的字段并上传图片');\r\n        return;\r\n      }\r\n\r\n      // 准备表单数据\r\n      const formData = new FormData();\r\n      formData.append('shop_name', this.shopInfo.shopName);\r\n      formData.append('description', this.shopInfo.description);\r\n      formData.append('location', this.shopInfo.location);\r\n\r\n      // 追加图片数据\r\n      formData.append('picture', this.picture.file);\r\n      formData.append('shop_id', this.shopInfo.shop_id);\r\n\r\n      axios.post('http://localhost:8081/shop/updateShop', formData)\r\n            .then(response => {\r\n              if ( response.status === 200 ){\r\n                alert('申请成功');\r\n                window.location.reload();\r\n              }\r\n            })\r\n            .catch(error => {\r\n              console.error('申请失败', error);\r\n            });\r\n    },\r\n\r\n    // 提现功能\r\n    withdraw() {\r\n      if (this.isProcessing) return;\r\n\r\n      this.isProcessing = true;\r\n      // 模拟提现操作\r\n      setTimeout(() => {\r\n        alert('提现申请已提交');\r\n        this.isProcessing = false;\r\n      }, 1000);\r\n    },\r\n    handleFileUpload(event) {\r\n      const file = event.target.files[0];\r\n\r\n      if (file) {\r\n        const fileType = file.type;\r\n        const fileSize = file.size;\r\n\r\n        // 验证文件类型和大小\r\n        if (['image/jpeg', 'image/png'].includes(fileType) && fileSize <= 20 * 1024 * 1024) { // 限制大小为5MB以内\r\n          const reader = new FileReader();\r\n          reader.onload = (e) => {\r\n            this.picture = {\r\n              file: file,\r\n              preview: e.target.result\r\n            };\r\n          };\r\n          reader.readAsDataURL(file);\r\n        } else {\r\n          alert(\"只支持上传 jpg, jpeg, png 格式的图片，并且大小不能超过 20MB！\");\r\n        }\r\n      }\r\n    },\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.shop-management {\r\n  width: 80%;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n}\r\n\r\n.status-bar {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  background-color: #f0f0f0;\r\n  padding: 10px;\r\n  border-radius: 5px;\r\n}\r\n\r\n.status-message {\r\n  font-size: 16px;\r\n}\r\n\r\n.action-buttons button {\r\n  margin-left: 10px;\r\n}\r\n\r\n.shop-details {\r\n  margin-top: 20px;\r\n  background-color: #fff;\r\n  padding: 20px;\r\n  border-radius: 5px;\r\n  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.shop-details h2 {\r\n  font-size: 20px;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.form-group {\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.form-group label {\r\n  display: block;\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.form-group input,\r\n.form-group textarea {\r\n  width: 100%;\r\n  padding: 8px;\r\n  font-size: 14px;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n}\r\n\r\n.buttons {\r\n  margin-top: 20px;\r\n}\r\n\r\n.buttons button {\r\n  padding: 10px 20px;\r\n  font-size: 14px;\r\n  cursor: pointer;\r\n  margin-right: 10px;\r\n}\r\n\r\n.buttons button:disabled {\r\n  cursor: not-allowed;\r\n  background-color: #ccc;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}